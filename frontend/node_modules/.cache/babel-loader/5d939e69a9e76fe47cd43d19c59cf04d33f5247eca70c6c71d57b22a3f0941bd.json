{"ast":null,"code":"import { pool } from \"../db.js\";\nexport const saveAudit = async (req, res) => {\n  try {\n    console.log(\"Audit reçu :\", req.body); // debug\n\n    const {\n      reglementation_id,\n      conformite,\n      risque,\n      faisabilite,\n      plan_action,\n      deadline,\n      owner\n    } = req.body;\n    if (!reglementation_id) {\n      return res.status(400).json({\n        error: \"reglementation_id manquant\"\n      });\n    }\n    const sql = `\n      INSERT INTO audit_conformite \n        (reglementation_id, conformite, risque, faisabilite, plan_action, deadline, owner)\n      VALUES ($1,$2,$3,$4,$5,$6,$7)\n      ON CONFLICT (reglementation_id)\n      DO UPDATE SET \n        conformite=$2, risque=$3, faisabilite=$4, plan_action=$5, deadline=$6, owner=$7\n      RETURNING *;\n    `;\n    const {\n      rows\n    } = await pool.query(sql, [reglementation_id, conformite || null, risque || null, faisabilite || null, plan_action || null, deadline || null, owner || null]);\n    res.json({\n      success: true,\n      audit: rows[0]\n    });\n  } catch (err) {\n    console.error(\"Erreur saveAudit :\", err);\n    res.status(500).json({\n      error: \"Erreur serveur\"\n    });\n  }\n};","map":{"version":3,"names":["pool","saveAudit","req","res","console","log","body","reglementation_id","conformite","risque","faisabilite","plan_action","deadline","owner","status","json","error","sql","rows","query","success","audit","err"],"sources":["C:/Users/ELITE COMPUTER/Documents/sites web/Projets/1. Smart Safety services/Version 2/frontend/src/components/ReglementationSearch.jsx"],"sourcesContent":["import { pool } from \"../db.js\";\r\n\r\nexport const saveAudit = async (req, res) => {\r\n  try {\r\n    console.log(\"Audit reçu :\", req.body); // debug\r\n\r\n    const { reglementation_id, conformite, risque, faisabilite, plan_action, deadline, owner } = req.body;\r\n\r\n    if (!reglementation_id) {\r\n      return res.status(400).json({ error: \"reglementation_id manquant\" });\r\n    }\r\n\r\n    const sql = `\r\n      INSERT INTO audit_conformite \r\n        (reglementation_id, conformite, risque, faisabilite, plan_action, deadline, owner)\r\n      VALUES ($1,$2,$3,$4,$5,$6,$7)\r\n      ON CONFLICT (reglementation_id)\r\n      DO UPDATE SET \r\n        conformite=$2, risque=$3, faisabilite=$4, plan_action=$5, deadline=$6, owner=$7\r\n      RETURNING *;\r\n    `;\r\n\r\n    const { rows } = await pool.query(sql, [\r\n      reglementation_id,\r\n      conformite || null,\r\n      risque || null,\r\n      faisabilite || null,\r\n      plan_action || null,\r\n      deadline || null,\r\n      owner || null\r\n    ]);\r\n\r\n    res.json({ success: true, audit: rows[0] });\r\n  } catch (err) {\r\n    console.error(\"Erreur saveAudit :\", err);\r\n    res.status(500).json({ error: \"Erreur serveur\" });\r\n  }\r\n};\r\n"],"mappings":"AAAA,SAASA,IAAI,QAAQ,UAAU;AAE/B,OAAO,MAAMC,SAAS,GAAG,MAAAA,CAAOC,GAAG,EAAEC,GAAG,KAAK;EAC3C,IAAI;IACFC,OAAO,CAACC,GAAG,CAAC,cAAc,EAAEH,GAAG,CAACI,IAAI,CAAC,CAAC,CAAC;;IAEvC,MAAM;MAAEC,iBAAiB;MAAEC,UAAU;MAAEC,MAAM;MAAEC,WAAW;MAAEC,WAAW;MAAEC,QAAQ;MAAEC;IAAM,CAAC,GAAGX,GAAG,CAACI,IAAI;IAErG,IAAI,CAACC,iBAAiB,EAAE;MACtB,OAAOJ,GAAG,CAACW,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;QAAEC,KAAK,EAAE;MAA6B,CAAC,CAAC;IACtE;IAEA,MAAMC,GAAG,GAAG;AAChB;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;IAED,MAAM;MAAEC;IAAK,CAAC,GAAG,MAAMlB,IAAI,CAACmB,KAAK,CAACF,GAAG,EAAE,CACrCV,iBAAiB,EACjBC,UAAU,IAAI,IAAI,EAClBC,MAAM,IAAI,IAAI,EACdC,WAAW,IAAI,IAAI,EACnBC,WAAW,IAAI,IAAI,EACnBC,QAAQ,IAAI,IAAI,EAChBC,KAAK,IAAI,IAAI,CACd,CAAC;IAEFV,GAAG,CAACY,IAAI,CAAC;MAAEK,OAAO,EAAE,IAAI;MAAEC,KAAK,EAAEH,IAAI,CAAC,CAAC;IAAE,CAAC,CAAC;EAC7C,CAAC,CAAC,OAAOI,GAAG,EAAE;IACZlB,OAAO,CAACY,KAAK,CAAC,oBAAoB,EAAEM,GAAG,CAAC;IACxCnB,GAAG,CAACW,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;MAAEC,KAAK,EAAE;IAAiB,CAAC,CAAC;EACnD;AACF,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}